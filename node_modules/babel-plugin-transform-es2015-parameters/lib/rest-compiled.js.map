{"version":3,"sources":["rest.js"],"names":[],"mappings":"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","file":"rest-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.visitor = undefined;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildRest = (0, _babelTemplate2.default)(\"\\n  for (var LEN = ARGUMENTS.length,\\n           ARRAY = Array(ARRAY_LEN),\\n           KEY = START;\\n       KEY < LEN;\\n       KEY++) {\\n    ARRAY[ARRAY_KEY] = ARGUMENTS[KEY];\\n  }\\n\");\n\nvar restIndex = (0, _babelTemplate2.default)(\"\\n  ARGUMENTS.length <= INDEX ? undefined : ARGUMENTS[INDEX]\\n\");\n\nvar restLength = (0, _babelTemplate2.default)(\"\\n  ARGUMENTS.length <= OFFSET ? 0 : ARGUMENTS.length - OFFSET\\n\");\n\nvar memberExpressionOptimisationVisitor = {\n  Scope: function Scope(path, state) {\n    if (!path.scope.bindingIdentifierEquals(state.name, state.outerBinding)) {\n      path.skip();\n    }\n  },\n  Flow: function Flow(path) {\n    if (path.isTypeCastExpression()) return;\n\n    path.skip();\n  },\n\n\n  \"Function|ClassProperty\": function FunctionClassProperty(path, state) {\n    var oldNoOptimise = state.noOptimise;\n    state.noOptimise = true;\n    path.traverse(memberExpressionOptimisationVisitor, state);\n    state.noOptimise = oldNoOptimise;\n\n    path.skip();\n  },\n\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    var node = path.node;\n\n    if (node.name === \"arguments\") {\n      state.deopted = true;\n    }\n\n    if (node.name !== state.name) return;\n\n    if (state.noOptimise) {\n      state.deopted = true;\n    } else {\n      var parentPath = path.parentPath;\n\n      if (parentPath.isMemberExpression({ object: node })) {\n        var grandparentPath = parentPath.parentPath;\n\n        var argsOptEligible = !state.deopted && !(grandparentPath.isAssignmentExpression() && parentPath.node === grandparentPath.node.left || grandparentPath.isLVal() || grandparentPath.isForXStatement() || grandparentPath.isUpdateExpression() || grandparentPath.isUnaryExpression({ operator: \"delete\" }) || (grandparentPath.isCallExpression() || grandparentPath.isNewExpression()) && parentPath.node === grandparentPath.node.callee);\n\n        if (argsOptEligible) {\n          if (parentPath.node.computed) {\n            if (parentPath.get(\"property\").isBaseType(\"number\")) {\n              state.candidates.push({ cause: \"indexGetter\", path: path });\n              return;\n            }\n          } else if (parentPath.node.property.name === \"length\") {\n              state.candidates.push({ cause: \"lengthGetter\", path: path });\n              return;\n            }\n        }\n      }\n\n      if (state.offset === 0 && parentPath.isSpreadElement()) {\n        var call = parentPath.parentPath;\n        if (call.isCallExpression() && call.node.arguments.length === 1) {\n          state.candidates.push({ cause: \"argSpread\", path: path });\n          return;\n        }\n      }\n\n      state.references.push(path);\n    }\n  },\n  BindingIdentifier: function BindingIdentifier(_ref, state) {\n    var node = _ref.node;\n\n    if (node.name === state.name) {\n      state.deopted = true;\n    }\n  }\n};\nfunction hasRest(node) {\n  return t.isRestElement(node.params[node.params.length - 1]);\n}\n\nfunction optimiseIndexGetter(path, argsId, offset) {\n  var index = void 0;\n\n  if (t.isNumericLiteral(path.parent.property)) {\n    index = t.numericLiteral(path.parent.property.value + offset);\n  } else {\n    index = t.binaryExpression(\"+\", path.parent.property, t.numericLiteral(offset));\n  }\n\n  path.parentPath.replaceWith(restIndex({\n    ARGUMENTS: argsId,\n    INDEX: index\n  }));\n}\n\nfunction optimiseLengthGetter(path, argsId, offset) {\n  if (offset) {\n    path.parentPath.replaceWith(restLength({\n      ARGUMENTS: argsId,\n      OFFSET: t.numericLiteral(offset)\n    }));\n  } else {\n    path.replaceWith(argsId);\n  }\n}\n\nvar visitor = exports.visitor = {\n  Function: function Function(path) {\n    var node = path.node;\n    var scope = path.scope;\n\n    if (!hasRest(node)) return;\n\n    var rest = node.params.pop().argument;\n\n    var argsId = t.identifier(\"arguments\");\n\n    argsId._shadowedFunctionLiteral = path;\n\n    var state = {\n      references: [],\n      offset: node.params.length,\n\n      argumentsNode: argsId,\n      outerBinding: scope.getBindingIdentifier(rest.name),\n\n      candidates: [],\n\n      name: rest.name,\n\n      deopted: false\n    };\n\n    path.traverse(memberExpressionOptimisationVisitor, state);\n\n    if (!state.deopted && !state.references.length) {\n      for (var _iterator = state.candidates, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n        var _ref2;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref2 = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref2 = _i.value;\n        }\n\n        var _ref3 = _ref2;\n        var _path = _ref3.path;\n        var cause = _ref3.cause;\n\n        switch (cause) {\n          case \"indexGetter\":\n            optimiseIndexGetter(_path, argsId, state.offset);\n            break;\n          case \"lengthGetter\":\n            optimiseLengthGetter(_path, argsId, state.offset);\n            break;\n          default:\n            _path.replaceWith(argsId);\n        }\n      }\n      return;\n    }\n\n    state.references = state.references.concat(state.candidates.map(function (_ref4) {\n      var path = _ref4.path;\n      return path;\n    }));\n\n    state.deopted = state.deopted || !!node.shadow;\n\n    var start = t.numericLiteral(node.params.length);\n    var key = scope.generateUidIdentifier(\"key\");\n    var len = scope.generateUidIdentifier(\"len\");\n\n    var arrKey = key;\n    var arrLen = len;\n    if (node.params.length) {\n      arrKey = t.binaryExpression(\"-\", key, start);\n\n      arrLen = t.conditionalExpression(t.binaryExpression(\">\", len, start), t.binaryExpression(\"-\", len, start), t.numericLiteral(0));\n    }\n\n    var loop = buildRest({\n      ARGUMENTS: argsId,\n      ARRAY_KEY: arrKey,\n      ARRAY_LEN: arrLen,\n      START: start,\n      ARRAY: rest,\n      KEY: key,\n      LEN: len\n    });\n\n    if (state.deopted) {\n      loop._blockHoist = node.params.length + 1;\n      node.body.body.unshift(loop);\n    } else {\n      loop._blockHoist = 1;\n\n      var target = path.getEarliestCommonAncestorFrom(state.references).getStatementParent();\n\n      target.findParent(function (path) {\n        if (path.isLoop()) {\n          target = path;\n        } else {\n          return path.isFunction();\n        }\n      });\n\n      target.insertBefore(loop);\n    }\n  }\n};"]}