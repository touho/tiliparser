{"version":3,"sources":["tdz.js"],"names":[],"mappings":"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","file":"tdz-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.visitor = undefined;\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction getTDZStatus(refPath, bindingPath) {\n  var executionStatus = bindingPath._guessExecutionStatusRelativeTo(refPath);\n\n  if (executionStatus === \"before\") {\n    return \"inside\";\n  } else if (executionStatus === \"after\") {\n    return \"outside\";\n  } else {\n    return \"maybe\";\n  }\n}\n\nfunction buildTDZAssert(node, file) {\n  return t.callExpression(file.addHelper(\"temporalRef\"), [node, t.stringLiteral(node.name), file.addHelper(\"temporalUndefined\")]);\n}\n\nfunction isReference(node, scope, state) {\n  var declared = state.letReferences[node.name];\n  if (!declared) return false;\n\n  return scope.getBindingIdentifier(node.name) === declared;\n}\n\nvar visitor = exports.visitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    if (!this.file.opts.tdz) return;\n\n    var node = path.node;\n    var parent = path.parent;\n    var scope = path.scope;\n\n\n    if (path.parentPath.isFor({ left: node })) return;\n    if (!isReference(node, scope, state)) return;\n\n    var bindingPath = scope.getBinding(node.name).path;\n\n    var status = getTDZStatus(path, bindingPath);\n    if (status === \"inside\") return;\n\n    if (status === \"maybe\") {\n      var assert = buildTDZAssert(node, state.file);\n\n      bindingPath.parent._tdzThis = true;\n\n      path.skip();\n\n      if (path.parentPath.isUpdateExpression()) {\n        if (parent._ignoreBlockScopingTDZ) return;\n        path.parentPath.replaceWith(t.sequenceExpression([assert, parent]));\n      } else {\n        path.replaceWith(assert);\n      }\n    } else if (status === \"outside\") {\n      path.replaceWith(t.throwStatement(t.inherits(t.newExpression(t.identifier(\"ReferenceError\"), [t.stringLiteral(node.name + \" is not defined - temporal dead zone\")]), node)));\n    }\n  },\n\n\n  AssignmentExpression: {\n    exit: function exit(path, state) {\n      if (!this.file.opts.tdz) return;\n\n      var node = path.node;\n\n      if (node._ignoreBlockScopingTDZ) return;\n\n      var nodes = [];\n      var ids = path.getBindingIdentifiers();\n\n      for (var name in ids) {\n        var id = ids[name];\n\n        if (isReference(id, path.scope, state)) {\n          nodes.push(buildTDZAssert(id, state.file));\n        }\n      }\n\n      if (nodes.length) {\n        node._ignoreBlockScopingTDZ = true;\n        nodes.push(node);\n        path.replaceWithMultiple(nodes.map(t.expressionStatement));\n      }\n    }\n  }\n};"]}