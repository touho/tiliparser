{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (_ref) {\n  var t = _ref.types;\n\n  function isValidDefine(path) {\n    if (!path.isExpressionStatement()) return;\n\n    var expr = path.get(\"expression\");\n    if (!expr.isCallExpression()) return false;\n    if (!expr.get(\"callee\").isIdentifier({ name: \"define\" })) return false;\n\n    var args = expr.get(\"arguments\");\n    if (args.length === 3 && !args.shift().isStringLiteral()) return false;\n    if (args.length !== 2) return false;\n    if (!args.shift().isArrayExpression()) return false;\n    if (!args.shift().isFunctionExpression()) return false;\n\n    return true;\n  }\n\n  return {\n    inherits: require(\"babel-plugin-transform-es2015-modules-amd\"),\n\n    visitor: {\n      Program: {\n        exit: function exit(path, state) {\n          var last = path.get(\"body\").pop();\n          if (!isValidDefine(last)) return;\n\n          var call = last.node.expression;\n          var args = call.arguments;\n\n          var moduleName = args.length === 3 ? args.shift() : null;\n          var amdArgs = call.arguments[0];\n          var func = call.arguments[1];\n          var browserGlobals = state.opts.globals || {};\n\n          var commonArgs = amdArgs.elements.map(function (arg) {\n            if (arg.value === \"module\" || arg.value === \"exports\") {\n              return t.identifier(arg.value);\n            } else {\n              return t.callExpression(t.identifier(\"require\"), [arg]);\n            }\n          });\n\n          var browserArgs = amdArgs.elements.map(function (arg) {\n            if (arg.value === \"module\") {\n              return t.identifier(\"mod\");\n            } else if (arg.value === \"exports\") {\n              return t.memberExpression(t.identifier(\"mod\"), t.identifier(\"exports\"));\n            } else {\n              var memberExpression = void 0;\n\n              if (state.opts.exactGlobals) {\n                var globalRef = browserGlobals[arg.value];\n                if (globalRef) {\n                  memberExpression = globalRef.split(\".\").reduce(function (accum, curr) {\n                    return t.memberExpression(accum, t.identifier(curr));\n                  }, t.identifier(\"global\"));\n                } else {\n                  memberExpression = t.memberExpression(t.identifier(\"global\"), t.identifier(t.toIdentifier(arg.value)));\n                }\n              } else {\n                var requireName = (0, _path.basename)(arg.value, (0, _path.extname)(arg.value));\n                var globalName = browserGlobals[requireName] || requireName;\n                memberExpression = t.memberExpression(t.identifier(\"global\"), t.identifier(t.toIdentifier(globalName)));\n              }\n\n              return memberExpression;\n            }\n          });\n\n          var moduleNameOrBasename = moduleName ? moduleName.value : this.file.opts.basename;\n          var globalToAssign = t.memberExpression(t.identifier(\"global\"), t.identifier(t.toIdentifier(moduleNameOrBasename)));\n          var prerequisiteAssignments = null;\n\n          if (state.opts.exactGlobals) {\n            var globalName = browserGlobals[moduleNameOrBasename];\n\n            if (globalName) {\n              prerequisiteAssignments = [];\n\n              var members = globalName.split(\".\");\n              globalToAssign = members.slice(1).reduce(function (accum, curr) {\n                prerequisiteAssignments.push(buildPrerequisiteAssignment({ GLOBAL_REFERENCE: accum }));\n                return t.memberExpression(accum, t.identifier(curr));\n              }, t.memberExpression(t.identifier(\"global\"), t.identifier(members[0])));\n            }\n          }\n\n          var globalExport = buildGlobalExport({\n            BROWSER_ARGUMENTS: browserArgs,\n            PREREQUISITE_ASSIGNMENTS: prerequisiteAssignments,\n            GLOBAL_TO_ASSIGN: globalToAssign\n          });\n\n          last.replaceWith(buildWrapper({\n            MODULE_NAME: moduleName,\n            AMD_ARGUMENTS: amdArgs,\n            COMMON_ARGUMENTS: commonArgs,\n            GLOBAL_EXPORT: globalExport,\n            FUNC: func\n          }));\n        }\n      }\n    }\n  };\n};\n\nvar _path = require(\"path\");\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/* eslint max-len: 0 */\n\nvar buildPrerequisiteAssignment = (0, _babelTemplate2.default)(\"\\n  GLOBAL_REFERENCE = GLOBAL_REFERENCE || {}\\n\");\n\nvar buildGlobalExport = (0, _babelTemplate2.default)(\"\\n  var mod = { exports: {} };\\n  factory(BROWSER_ARGUMENTS);\\n  PREREQUISITE_ASSIGNMENTS\\n  GLOBAL_TO_ASSIGN = mod.exports;\\n\");\n\nvar buildWrapper = (0, _babelTemplate2.default)(\"\\n  (function (global, factory) {\\n    if (typeof define === \\\"function\\\" && define.amd) {\\n      define(MODULE_NAME, AMD_ARGUMENTS, factory);\\n    } else if (typeof exports !== \\\"undefined\\\") {\\n      factory(COMMON_ARGUMENTS);\\n    } else {\\n      GLOBAL_EXPORT\\n    }\\n  })(this, FUNC);\\n\");\n\nmodule.exports = exports[\"default\"];"]}