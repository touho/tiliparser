{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["/*istanbul ignore next*/\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function ( /*istanbul ignore next*/_ref) {\n  /*istanbul ignore next*/var node = _ref.node;\n  /*istanbul ignore next*/var parent = _ref.parent;\n  /*istanbul ignore next*/var scope = _ref.scope;\n  /*istanbul ignore next*/var id = _ref.id;\n\n  // has an `id` so we don't need to infer one\n  if (node.id) return;\n\n  if ((t.isObjectProperty(parent) || t.isObjectMethod(parent, { kind: \"method\" })) && (!parent.computed || t.isLiteral(parent.key))) {\n    // { foo() {} };\n    id = parent.key;\n  } else if (t.isVariableDeclarator(parent)) {\n    // let foo = function () {};\n    id = parent.id;\n\n    if (t.isIdentifier(id)) {\n      var binding = scope.parent.getBinding(id.name);\n      if (binding && binding.constant && scope.getBinding(id.name) === binding) {\n        // always going to reference this method\n        node.id = id;\n        node.id[t.NOT_LOCAL_BINDING] = true;\n        return;\n      }\n    }\n  } else if (t.isAssignmentExpression(parent)) {\n    // foo = function () {};\n    id = parent.left;\n  } else if (!id) {\n    return;\n  }\n\n  var name = /*istanbul ignore next*/void 0;\n  if (id && t.isLiteral(id)) {\n    name = id.value;\n  } else if (id && t.isIdentifier(id)) {\n    name = id.name;\n  } else {\n    return;\n  }\n\n  name = t.toBindingIdentifierName(name);\n  id = t.identifier(name);\n\n  // The id shouldn't be considered a local binding to the function because\n  // we are simply trying to set the function name and not actually create\n  // a local binding.\n  id[t.NOT_LOCAL_BINDING] = true;\n\n  var state = visit(node, name, scope);\n  return wrap(state, node, id, scope) || node;\n};\n\nvar /*istanbul ignore next*/_babelHelperGetFunctionArity = require(\"babel-helper-get-function-arity\");\n\n/*istanbul ignore next*/\nvar _babelHelperGetFunctionArity2 = _interopRequireDefault(_babelHelperGetFunctionArity);\n\nvar /*istanbul ignore next*/_babelTemplate = require(\"babel-template\");\n\n/*istanbul ignore next*/\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar /*istanbul ignore next*/_babelTypes = require(\"babel-types\");\n\n/*istanbul ignore next*/\nvar t = _interopRequireWildcard(_babelTypes);\n\n/*istanbul ignore next*/\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildPropertyMethodAssignmentWrapper = /*istanbul ignore next*/(0, _babelTemplate2.default)( /*istanbul ignore next*/\"\\n  (function (FUNCTION_KEY) {\\n    function FUNCTION_ID() {\\n      return FUNCTION_KEY.apply(this, arguments);\\n    }\\n\\n    FUNCTION_ID.toString = function () {\\n      return FUNCTION_KEY.toString();\\n    }\\n\\n    return FUNCTION_ID;\\n  })(FUNCTION)\\n\"); /* eslint max-len: 0 */\n\nvar buildGeneratorPropertyMethodAssignmentWrapper = /*istanbul ignore next*/(0, _babelTemplate2.default)( /*istanbul ignore next*/\"\\n  (function (FUNCTION_KEY) {\\n    function* FUNCTION_ID() {\\n      return yield* FUNCTION_KEY.apply(this, arguments);\\n    }\\n\\n    FUNCTION_ID.toString = function () {\\n      return FUNCTION_KEY.toString();\\n    };\\n\\n    return FUNCTION_ID;\\n  })(FUNCTION)\\n\");\n\nvar visitor = { /*istanbul ignore next*/\n  \"ReferencedIdentifier|BindingIdentifier\": function ReferencedIdentifierBindingIdentifier(path, state) {\n    // check if this node matches our function id\n    if (path.node.name !== state.name) return;\n\n    // check that we don't have a local variable declared as that removes the need\n    // for the wrapper\n    var localDeclar = path.scope.getBindingIdentifier(state.name);\n    if (localDeclar !== state.outerDeclar) return;\n\n    state.selfReference = true;\n    path.stop();\n  }\n};\n\nfunction wrap(state, method, id, scope) {\n  if (state.selfReference) {\n    if (scope.hasBinding(id.name) && !scope.hasGlobal(id.name)) {\n      // we can just munge the local binding\n      scope.rename(id.name);\n    } else {\n      // we don't currently support wrapping class expressions\n      if (!t.isFunction(method)) return;\n\n      // need to add a wrapper since we can't change the references\n      var build = buildPropertyMethodAssignmentWrapper;\n      if (method.generator) build = buildGeneratorPropertyMethodAssignmentWrapper;\n      var _template = build({\n        FUNCTION: method,\n        FUNCTION_ID: id,\n        FUNCTION_KEY: scope.generateUidIdentifier(id.name)\n      }).expression;\n      _template.callee._skipModulesRemap = true;\n\n      // shim in dummy params to retain function arity, if you try to read the\n      // source then you'll get the original since it's proxied so it's all good\n      var params = _template.callee.body.body[0].params;\n      for (var i = 0, len = /*istanbul ignore next*/(0, _babelHelperGetFunctionArity2.default)(method); i < len; i++) {\n        params.push(scope.generateUidIdentifier(\"x\"));\n      }\n\n      return _template;\n    }\n  }\n\n  method.id = id;\n  scope.getProgramParent().references[id.name] = true;\n}\n\nfunction visit(node, name, scope) {\n  var state = {\n    selfAssignment: false,\n    selfReference: false,\n    outerDeclar: scope.getBindingIdentifier(name),\n    references: [],\n    name: name\n  };\n\n  // check to see if we have a local binding of the id we're setting inside of\n  // the function, this is important as there are caveats associated\n\n  var binding = scope.getOwnBinding(name);\n\n  if (binding) {\n    if (binding.kind === \"param\") {\n      // safari will blow up in strict mode with code like:\n      //\n      //   let t = function t(t) {};\n      //\n      // with the error:\n      //\n      //   Cannot declare a parameter named 't' as it shadows the name of a\n      //   strict mode function.\n      //\n      // this isn't to the spec and they've invented this behaviour which is\n      // **extremely** annoying so we avoid setting the name if it has a param\n      // with the same id\n      state.selfReference = true;\n    } else {\n      // otherwise it's defined somewhere in scope like:\n      //\n      //   let t = function () {\n      //     let t = 2;\n      //   };\n      //\n      // so we can safely just set the id and move along as it shadows the\n      // bound function id\n    }\n  } else if (state.outerDeclar || scope.hasGlobal(name)) {\n      scope.traverse(node, visitor, state);\n    }\n\n  return state;\n}\n\n/*istanbul ignore next*/module.exports = exports[\"default\"];"]}